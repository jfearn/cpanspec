FROM fedora:22


MAINTAINER "Jeff Fearn" <jfearn@redhat.com>

RUN useradd -ms /bin/bash cpanspec
RUN echo 'cpanspec ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers

# Install cpanspec deps
RUN dnf -y install \
  'perl(Archive::Tar)' \
  'perl(Archive::Zip)' \
  'perl(IO::Uncompress::Bunzip2)' \
  'perl(IPC::Run)' \
  'perl(LWP::UserAgent)' \
  'perl(Module::Build)' \
  'perl(Module::CoreList)' \
  'perl(Module::ExtractUse)' \
  'perl(Parse::CPAN::Packages)' \
  'perl(Pod::Simple::TextContent) >= 3.29' \
  'perl(Test::Deep)' \
  'perl(Test::NoWarnings)' \
  'perl(Test::Pod)' \
  'perl(Test::Pod::Coverage)' \
  'perl(Text::Autoformat)' \
  'perl(YAML)' \
  createrepo \
  deltarpm \
  gcc \
  python-dnf-plugins-core \
  rpm \
  rpm-build \
  rpmdevtools \
  sudo \
  tar \
  which

RUN dnf -y upgrade --exclude=util-linux --exclude=*.i686;

RUN dnf -y install 'perl(Perl::Version)'

USER cpanspec
ENV HOME /home/cpanspec
WORKDIR /tmp/deps
RUN rpmdev-setuptree

USER root
ADD cpanspec.repo /etc/yum.repos.d/cpanspec.repo

